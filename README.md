# *Дипломная работа*

## Тема: Создание сервиса авторизации по номеру телефона

## Задача: обеспечить простой и надежный механизм авторизации и реферальной системы, который можно будет легко тестировать и интегрировать в другие системы.


# Решение. В данной работе созданы 2 приложения:

### 1)  USERS
 * Модель (user) создана с полями:
    * phone: номер телефона пользователя
    * name: имя пользователя
    * last_name: фамилия пользователя
    * invite_code: код пользователя для приглашения других
    * activated_invite_code: активированный инвайт-код

 * Контроллены настроены на (пользователя):
    * Создание 
    * Получение данных
    * Обновление данных
      
        * контроллер SendCodeAPIVIEW - необходим для регистрации и одновременно может использоваться для входа в систему.(требует только номер телефона) - после чего высылается смс с кодом(имитация)
        * контроллер VerifyCodeAPIView - необходим для подтверждения кода, отправленного по смс. (требуется номер телефона и код)
        * контроллер ActivateInviteCodeView - необходим для ввода инвайт-кода(требует только шестизначный инвайт-код).


 * Панель администратора
    * Сортирует по полям (phone, activated_invite_code)
    * Поиск по полям (phone, name, last_name, activated_invite_code)
 
 * Сервисные функции
    * generate_invite_code - Создает рандомный инвайт-код (6 символов).
    * create_unique_invite_code - Создаёт и проверяет инвайт-код на повтор (дубликат кода).
    * generate_sms_code - Создает рандомный код для СМС сообщения (из 4х символов).
    * send - Отправляет СМС сообщение.

 * Создан валидатор номера телефона:
    * phone_validator - Валидация номера телефона и его проверка на соответствие форматц

### 2) INTERFACE
 * Реализовано:
    * Интерфейс для тестирования функционала (при помощи Django Templates)
    * Отправка СМС-кода для авторизации по номеру телефона (при помощи сервиса из ТЗ к данной работе, а именно SmsAero)
    * Документация сервиса SmsAero https://smsaero.ru/integration/documentation/api/
 
#### Для начала работы с сервисом SmsAero необходимо:
 * Зарегестрироваться на сайте (https://smsaero.ru/)
 * Установить модуль с помощью команды: *pip install -U smsaero-api*
 * В модуль *settings.py* добавить следующие значения:
    * SMSAERO_EMAIL - логин
    * SMSAERO_API_KEY - API-ключ, который получен после регистрации в ЛК на сайте SmsAero.

### Тестирование функционала:
 * Запустить тестирование командой: *$ coverage run --source=users manage.py test users*
 * Отобразить результат тестов командой: *$ coverage report*

### DOCKER
 * Запустить виртуальное окружение и установить зависимости проекта командой: *$ pip install -r requirements.txt*
 * Добавить себе в проект файл .env с нужными для работы паролями
 * Выполнить команду: *$ docker-compose up -d --build*
 * Чтобы стать суперпользователем (phone='79125059770' code='1234'), выполните команду: *$ docker-compose exec app python manage.py csu*