# *Дипломная работа*

## Тема: Создание сервиса авторизации по номеру телефона

## Задача: обеспечить простой и надежный механизм авторизации и реферальной системы, который можно будет легко тестировать и интегрировать в другие системы.


### DOCKER
 * Добавить себе в проект файл .env с нужными для работы паролями
 * Выполнить команду: *$ docker-compose up -d --build*
 * Чтобы стать суперпользователем (phone='79125059770' code='1234'), выполните команду: *$ docker-compose exec app python manage.py csu*

# Решение. В данной работе созданы 2 приложения:

### 1)  USERS
 * Модель (user) создана с полями:
    * phone: номер телефона пользователя
    * name: имя пользователя
    * last_name: фамилия пользователя
    * invite_code: код пользователя для приглашения других
    * activated_invite_code: активированный инвайт-код
    * code: код подтверждения
    * code_created_at: время создания кода
    * code_is_active: активность кода

 * Контроллены настроены (на пользователя):
    * Регистрация/логин(SendCodeAPIView)
      1) Ссылка: 'http://127.0.0.1:8000/users/login/'
      2) Метод POST
      3) Данные для обработки необходимо подать: "phone"   
    * Верификация кода(VerifyCodeAPIView):
      1) Ссылка: 'http://127.0.0.1:8000/users/login/verify/'
      2) Метод POST
      3) Данные для обработки необходимо подать: "phone", "code"
    * Получение данных(UserProfileRetrieveAPIView):
      1) Ссылка: 'http://127.0.0.1:8000/users/profile/(id пользователя)/'
      2) Метод GET
      3) Необходимо указывать access-токен, который выдается в контроллере VerifyCodeAPIView
    * Обновление данных(UserUpdateAPIView):
      1) Ссылка: 'http://127.0.0.1:8000/users/profiles/update/(id пользователя)/'
      2) Метод PATCH, PUT
      3) Данные, для обработки можно подать: любое поле из модели User, либо поля
      4) Необходимо указывать access-токен, который выдается в контроллере VerifyCodeAPIView
    * Активация инвайт-кода(ActivateInviteCodeView):
      1) Ссылка: 'http://127.0.0.1:8000/users/activate_invite_code/'
      2) Метод POST
      3) Данные для обработки необходимо подать: "invite_code"
   

   


 * Панель администратора
    * Сортирует по полям (phone, activated_invite_code)
    * Поиск по полям (phone, name, last_name, activated_invite_code)
 
 * Сервисные функции
    * generate_invite_code - Создает рандомный инвайт-код (6 символов).
    * create_unique_invite_code - Создаёт и проверяет инвайт-код на повтор (дубликат кода).
    * generate_sms_code - Создает рандомный код для СМС сообщения (из 4х символов).
    * send - Отправляет СМС сообщение.

 * Создан валидатор номера телефона:
    * phone_validator - Валидация номера телефона и его проверка на соответствие форматц

### 2) INTERFACE
 * Реализовано:
    * Интерфейс для тестирования функционала (при помощи Django Templates)
    * Отправка СМС-кода для авторизации по номеру телефона (при помощи сервиса из ТЗ к данной работе, а именно SmsAero)
    * Документация сервиса SmsAero https://smsaero.ru/integration/documentation/api/
 
#### Для начала работы с сервисом SmsAero необходимо:
 * Зарегестрироваться на сайте (https://smsaero.ru/)
 * Установить модуль с помощью команды: *pip install -U smsaero-api*
 * В модуль *settings.py* добавить следующие значения:
    * SMSAERO_EMAIL - логин
    * SMSAERO_API_KEY - API-ключ, который получен после регистрации в ЛК на сайте SmsAero.

### Тестирование функционала:
 * Запустить тестирование командой: *$ docker-compose exec app python manage.py test *
 * Отобразить результат тестов командой: *$ docker-compose exec app coverage report*
